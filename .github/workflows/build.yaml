name: Build Skia on Update

on:
  schedule:
    - cron: '0 * * * *'  # Runs hourly
  workflow_dispatch:
  push:

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Clone Skia repo
        run: |
          git clone --depth 1 https://github.com/google/skia.git
          cd skia
          echo "latest_commit=$(git rev-parse HEAD)" >> $GITHUB_ENV

      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Check for new commits
        id: check_commit
        run: gh variable set LAST_COMMIT_HASH --body "$latest_commit"
        env:
          GH_TOKEN: ${{ secrets.PAT }}
        continue-on-error: true
      
      - name: Compare with last commit hash
        env:
          commitHash: ${{ vars.LAST_COMMIT_HASH }}
        if: env.latest_commit != ${{ env.commitHash }}
        run: |
          echo "New commit found: Building Skia..."
          # Add build steps here, such as `./tools/build_script`
        
      - name: Save new commit hash
        env:
          commitHash: ${{ vars.LAST_COMMIT_HASH }}
        if: env.latest_commit != ${{ env.commitHash }}
        run: echo "LAST_COMMIT_HASH=$latest_commit" | tee -a $GITHUB_ENV
      
      - name: Release binaries
        if: success()
        run: |
          # Add steps to release binaries here
